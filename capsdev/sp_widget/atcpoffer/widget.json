{
    "instance": {
        "name": "capsdev",
        "url": "https://capsdev.service-now.com",
        "g_ck": "deddd3161bfc691094b0cbb5464bcb484a226a3f175006963caa5dfa744d95e6306d01c8"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "atcp_offer",
    "sys_id": "926b99011b71b8d094b0cbb5464bcb2e",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div class=\"panel b\" ng-init=\"registrationInit()\" style=\"\">\n   <!-- header -->\n   <div class=\"panel-heading\" style=\"background-color: #72ab9a;margin-top: -20px\">\n      <h1 class=\"panel-title\" style=\"color: white; text-align: center;\">Support automates - Saisie d'un <u>nouvel</u>\n         incident*</h1>\n     \n   </div>\n   <!-- body -->\n   <div class=\"panel-body\">\n      <p style=\"font-size: 17px;\">\n        * <b>Du lundi au vendredi <u>uniquement</u></b>.<br> Pour le samedi (de 9H à 14h), veuillez contacter l’astreinte via le numéro <b>05 63 67 27 00</b>.\n      </p>\n     <a class=\"btn btn-primary btn-xlg d-none hidden-lg hidden-md hidden-xl\" href=\"tel:05 63 67 27 00\" style=\"padding:10px;background-color:#72ab9a;margin-bottom:2rem\">\n   \t\t<span class=\"glyphicon glyphicon-earphone\" style=\"padding-right:10px;\"></span>05 63 67 27 00\n\t\t\t</a>\n     <br>\n      <form ng-submit=\"$event.preventDefault()\" class=\"form-horizontal\">\n         <!-- name_society_tech input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"name_society_tech\"><span style=\"padding-left: .25em\"\n                  title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.name_society_tech != '' && c.name_society_tech.split(' ').length > 1}\"></span>\n               ${name_society_tech}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.name_society_tech\" id=\"name_society_tech\" name=\"name_society_tech\"\n                  placeholder=\"${Dupont Dupond (CAPS)}\" class=\"form-control\"\n                  style=\"{{ c.name_society_tech.split(' ').length > 1 ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- Phone input-->\n         <div class=\"form-group\" ng-show='true'>\n            <label class=\"col-sm-3 control-label\" for=\"phone\"><span style=\"padding-left: .25em\" title=\"Mandatory\"\n                  class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.phone != '' && c.checkPhoneNumber()}\"></span>\n               ${phone}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.phone\" id=\"phone\" name=\"phone\" placeholder=\"0676565XXX\" class=\"form-control\"\n                  style=\"{{ c.checkPhoneNumber() ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- Num automate input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"automate_num\"><span style=\"padding-left: .25em\" title=\"Mandatory\"\n                  class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.automate_num.toString().length == 13  && +c.automate_num}\"></span>\n               ${automate_number}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.automate_num\" id=\"automate_num\" name=\"automate_num\" placeholder=\"${XXXX391828391}\"\n                  class=\"form-control\"\n                  style=\"{{ c.automate_num.toString().length == 13  && +c.automate_num ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- panne_description input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"panne_description\"><span style=\"padding-left: .25em\"\n                  title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.panne_description != ''}\"></span>\n               ${panne_description}</label>\n            <div class=\"col-sm-6\">\n               <textarea ng-model=\"c.panne_description\" id=\"panne_description\" name=\"panne_description\"\n                  placeholder=\"${panne_description_placeholder}\" class=\"form-control\"\n                  style=\"max-width:100%;min-width:100%;max-height:150px;min-height:70px;{{ c.panne_description != '' ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\">\n            </textarea>\n            </div>\n         </div>\n\n         <!-- mail input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"mail\"><!--<span style=\"padding-left: .25em\" title=\"Mandatory\" ng-class=\"{'mandatory-filled': c.mail != '' && c.checkEmail()}\"\n                  class=\"fa fa-asterisk mandatory\"></span> -->\n               Mail</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.mail\" id=\"mail\" name=\"mail\" placeholder=\"${mail}\"\n                  class=\"form-control\"ng-disabled=\"data.display\" ><!--style=\"{{ c.mail != '' && c.checkEmail() ? '' : 'border-color: #ed8f8f;'}}\"-->\n            </div>\n         </div>\n\n\n         <!-- Privacy Policy & Terms conditions -->\n         <div class=\"form-group col-sm-12 input-group-checkbox\">\n            <div class=\"col-sm-6 form_link col-sm-offset-3\" tabindex=\"0\" style=\"margin-bottom: -9px;\">\n               <label class=\"control-label adjust-label\" for=\"checkbox_agree\">\n                  <input ng-model=\"c.policy\" id=\"checkbox_agree\" class=\"checkbox_agree\" type=\"checkbox\" name=\"policy\">\n                  ${I agree to the} <a href=\"/sn_customerservice_registration_privacy_policy_doc.do\"\n                     target=\"_blank\">${Privacy Policy}</a>\n                  ${and Community} <a href=\"/sn_customerservice_registration_terms_doc.do\" target=\"_blank\">${Terms and\n                     Conditions}</a>\n                  <span style=\"padding-left: .25em\" title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                     ng-class=\"{'mandatory-filled': c.policy}\"></span>\n               </label>\n            </div>\n         </div>\n         \n         <!-- Captcha V3-->\n         <script\n            src=\"https://www.google.com/recaptcha/enterprise.js?render=6LeZ2SEkAAAAAFqpkGiFGRDoM8-9stGeLvilQQtN\"></script>\n         <div>\n            <button type=\"submit\" \n               class=\"btn btn-primary\" ng-disabled=\"c.showSubmit()\" ng-click=\"c.action()\">${Submit}</button>\n            <span style=\"margin-left: 1em;\"><i>Le symbole \"\n                  <span style=\"padding-left: .25em; margin-top:5px;\" title=\"Mandatory\"\n                     class=\"fa fa-asterisk mandatory\"></span>\" indique une saisie obligatoire</i></span>\n         </div>\n      </form>\n   </div>",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div class=\"panel b\" ng-init=\"registrationInit()\" style=\"\">\n   <!-- header -->\n   <div class=\"panel-heading\" style=\"background-color: #72ab9a;margin-top: -20px\">\n      <h1 class=\"panel-title\" style=\"color: white; text-align: center;\">Support automates - Saisie d'un <u>nouvel</u>\n         incident*</h1>\n     \n   </div>\n   <!-- body -->\n   <div class=\"panel-body\">\n      <p style=\"font-size: 17px;\">\n        * <b>Du lundi au vendredi <u>uniquement</u></b>.<br> Pour le samedi (de 9H à 14h), veuillez contacter l’astreinte via le numéro <b>05 63 67 27 00</b>.\n      </p>\n     <a class=\"btn btn-primary btn-xlg d-none hidden-lg hidden-md hidden-xl\" href=\"tel:05 63 67 27 00\" style=\"padding:10px;background-color:#72ab9a;margin-bottom:2rem\">\n   \t\t<span class=\"glyphicon glyphicon-earphone\" style=\"padding-right:10px;\"></span>05 63 67 27 00\n\t\t\t</a>\n     <br>\n      <form ng-submit=\"$event.preventDefault()\" class=\"form-horizontal\">\n         <!-- name_society_tech input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"name_society_tech\"><span style=\"padding-left: .25em\"\n                  title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.name_society_tech != '' && c.name_society_tech.split(' ').length > 1}\"></span>\n               ${name_society_tech}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.name_society_tech\" id=\"name_society_tech\" name=\"name_society_tech\"\n                  placeholder=\"${Dupont Dupond (CAPS)}\" class=\"form-control\"\n                  style=\"{{ c.name_society_tech.split(' ').length > 1 ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- Phone input-->\n         <div class=\"form-group\" ng-show='true'>\n            <label class=\"col-sm-3 control-label\" for=\"phone\"><span style=\"padding-left: .25em\" title=\"Mandatory\"\n                  class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.phone != '' && c.checkPhoneNumber()}\"></span>\n               ${phone}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.phone\" id=\"phone\" name=\"phone\" placeholder=\"0676565XXX\" class=\"form-control\"\n                  style=\"{{ c.checkPhoneNumber() ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- Num automate input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"automate_num\"><span style=\"padding-left: .25em\" title=\"Mandatory\"\n                  class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.automate_num.toString().length == 13  && +c.automate_num}\"></span>\n               ${automate_number}</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.automate_num\" id=\"automate_num\" name=\"automate_num\" placeholder=\"${XXXX391828391}\"\n                  class=\"form-control\"\n                  style=\"{{ c.automate_num.toString().length == 13  && +c.automate_num ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\" >\n            </div>\n         </div>\n\n         <!-- panne_description input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"panne_description\"><span style=\"padding-left: .25em\"\n                  title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                  ng-class=\"{'mandatory-filled': c.panne_description != ''}\"></span>\n               ${panne_description}</label>\n            <div class=\"col-sm-6\">\n               <textarea ng-model=\"c.panne_description\" id=\"panne_description\" name=\"panne_description\"\n                  placeholder=\"${panne_description_placeholder}\" class=\"form-control\"\n                  style=\"max-width:100%;min-width:100%;max-height:150px;min-height:70px;{{ c.panne_description != '' ? '' : 'border-color: #ed8f8f;'}}\" ng-disabled=\"data.display\">\n            </textarea>\n            </div>\n         </div>\n\n         <!-- mail input-->\n         <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\" for=\"mail\"><!--<span style=\"padding-left: .25em\" title=\"Mandatory\" ng-class=\"{'mandatory-filled': c.mail != '' && c.checkEmail()}\"\n                  class=\"fa fa-asterisk mandatory\"></span> -->\n               Mail</label>\n            <div class=\"col-sm-6\">\n               <input ng-model=\"c.mail\" id=\"mail\" name=\"mail\" placeholder=\"${mail}\"\n                  class=\"form-control\"ng-disabled=\"data.display\" ><!--style=\"{{ c.mail != '' && c.checkEmail() ? '' : 'border-color: #ed8f8f;'}}\"-->\n            </div>\n         </div>\n\n\n         <!-- Privacy Policy & Terms conditions -->\n         <div class=\"form-group col-sm-12 input-group-checkbox\">\n            <div class=\"col-sm-6 form_link col-sm-offset-3\" tabindex=\"0\" style=\"margin-bottom: -9px;\">\n               <label class=\"control-label adjust-label\" for=\"checkbox_agree\">\n                  <input ng-model=\"c.policy\" id=\"checkbox_agree\" class=\"checkbox_agree\" type=\"checkbox\" name=\"policy\">\n                  ${I agree to the} <a href=\"/sn_customerservice_registration_privacy_policy_doc.do\"\n                     target=\"_blank\">${Privacy Policy}</a>\n                  ${and Community} <a href=\"/sn_customerservice_registration_terms_doc.do\" target=\"_blank\">${Terms and\n                     Conditions}</a>\n                  <span style=\"padding-left: .25em\" title=\"Mandatory\" class=\"fa fa-asterisk mandatory\"\n                     ng-class=\"{'mandatory-filled': c.policy}\"></span>\n               </label>\n            </div>\n         </div>\n         \n         <!-- Captcha V3-->\n         <script\n            src=\"https://www.google.com/recaptcha/enterprise.js?render=6LeZ2SEkAAAAAFqpkGiFGRDoM8-9stGeLvilQQtN\"></script>\n         <div>\n            <button type=\"submit\" \n               class=\"btn btn-primary\" ng-disabled=\"c.showSubmit()\" ng-click=\"c.action()\">${Submit}</button>\n            <span style=\"margin-left: 1em;\"><i>Le symbole \"\n                  <span style=\"padding-left: .25em; margin-top:5px;\" title=\"Mandatory\"\n                     class=\"fa fa-asterisk mandatory\"></span>\" indique une saisie obligatoire</i></span>\n         </div>\n      </form>\n   </div>",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".panel-heading h1 {\r\n  font-size: 1.3em;\r\n}\r\n\r\n.form_link a {\r\n  text-decoration: underline;\r\n}\r\n\r\ninput[type=\"checkbox\"]:focus{\r\n  outline-width:3px;\r\n  outline-color:$input-border-focus;\r\n  outline-style:solid;\r\n}\r\n\r\n.form_link a:focus {\r\n  outline-width:3px;\r\n  outline-color:$input-border-focus;\r\n  outline-style:solid;\r\n  outline-offset:2px;\r\n}\r\n\r\n.adjust-label{\r\n  padding-top: 0px;\r\n  margin-bottom: 7px;\r\n  text-align: left;\r\n}\r\n  input:focus{\r\n    outline-style:solid;\r\n    outline-width:1px;\r\n  }\r\n\r\n.myselect {\r\n    display: block;\r\n    padding: 0 0 0 8px;\r\n    overflow: hidden;\r\n    position: relative;\r\n    border: 1px solid #bdc0c4;\r\n    white-space: nowrap;\r\n    font-size: .9em;\r\n    line-height: 32px;\r\n    height: 100%;\r\n    color: #444;\r\n    text-decoration: none;\r\n    border-radius: 4px;\r\n    background-clip: padding-box;\r\n    -webkit-user-select: none;\r\n    -moz-user-select: none;\r\n    user-select: none;\r\n    background-color: #fff;\r\n    min-height: 32px;\r\n   \r\n}\r\n\r\n.disabled-element {\r\n  opacity: 0.5;\r\n  pointer-events: none;\r\n  \r\n}\r\n\r\n::placeholder {\r\n  color: rgb(161, 161, 161);\r\n  font-style: italic;\r\n  // font-size: 1.5em;\r\n}",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".panel-heading h1 {\r\n  font-size: 1.3em;\r\n}\r\n\r\n.form_link a {\r\n  text-decoration: underline;\r\n}\r\n\r\ninput[type=\"checkbox\"]:focus{\r\n  outline-width:3px;\r\n  outline-color:$input-border-focus;\r\n  outline-style:solid;\r\n}\r\n\r\n.form_link a:focus {\r\n  outline-width:3px;\r\n  outline-color:$input-border-focus;\r\n  outline-style:solid;\r\n  outline-offset:2px;\r\n}\r\n\r\n.adjust-label{\r\n  padding-top: 0px;\r\n  margin-bottom: 7px;\r\n  text-align: left;\r\n}\r\n  input:focus{\r\n    outline-style:solid;\r\n    outline-width:1px;\r\n  }\r\n\r\n.myselect {\r\n    display: block;\r\n    padding: 0 0 0 8px;\r\n    overflow: hidden;\r\n    position: relative;\r\n    border: 1px solid #bdc0c4;\r\n    white-space: nowrap;\r\n    font-size: .9em;\r\n    line-height: 32px;\r\n    height: 100%;\r\n    color: #444;\r\n    text-decoration: none;\r\n    border-radius: 4px;\r\n    background-clip: padding-box;\r\n    -webkit-user-select: none;\r\n    -moz-user-select: none;\r\n    user-select: none;\r\n    background-color: #fff;\r\n    min-height: 32px;\r\n   \r\n}\r\n\r\n.disabled-element {\r\n  opacity: 0.5;\r\n  pointer-events: none;\r\n  \r\n}\r\n\r\n::placeholder {\r\n  color: rgb(161, 161, 161);\r\n  font-style: italic;\r\n  // font-size: 1.5em;\r\n}",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "public",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "public",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) { \n\n }",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) { \n\n }",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function ($sp, input, data, options) {\n\t// data.captch_url = 'https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit&hl=' + gs.getSession().getLanguage();\n\tdata.enableCaptcha = gs.getProperty('sn_customerservice.captchaEnabled');\n\tdata.captchaSiteKey = gs.getProperty('caps.recaptcha.site-key');\n\tvar captchaSiteKeySecret = gs.getProperty('caps.recaptcha.site-key.secret');\n\n\tif(input && input.action == 'register') {\n\t\tdata.captchaResponse = responseTokenRecaptcha(input.captchaToken);\n\t}\n\n\tif (input && input.action == 'register' && input.name_society_tech && input.automate_num && +input.automate_num && checkEmail(input.mail) && input.panne_description && input.phone && checkPhone(input.phone)) {\n\t\tif (data.captchaResponse.success == true && data.captchaResponse.score > 0.5) {\n\t\t\tgr = new GlideRecord('incident');\n\t\t\tgr.initialize();\n\t\t\tgr.applyTemplate('PRODUCTION PFA SUPPORT ALBI - PORTAIL');//MODELES INCIDENT AUTOMATE UNITAIRE\n\n\t\t\tvar inc_desc = '';\n\t\t\tvar lastNumber = input.automate_num.substr(input.automate_num.length - 5);\n\t\t\tvar gr_customerAccount;\n\n\t\t\tvar entities = [['HSBC', 'LCL', 'Chabières', 'Chalus'], ['30056', '30002', '41539', \"10188\"]];\n\n\t\t\tif (entities[1].indexOf(lastNumber) != -1) {\n\t\t\t\tinc_desc += 'Entité = ' + entities[0][entities[1].indexOf(lastNumber)];\n\t\t\t} else {\n\t\t\t\tgr_customerAccount = new GlideRecord('customer_account');\n\t\t\t\tgr_customerAccount.addQuery('parent', \"6cd347521b18849063b9dc29cd4bcb4a\");\n\t\t\t\tgr_customerAccount.addEncodedQuery('nameLIKE' + lastNumber);\n\t\t\t\tgr_customerAccount.query();\n\t\t\t\tgr_customerAccount.next();\n\t\t\t\tif (gr_customerAccount.name == '') {\n\t\t\t\t\tdata.status = \"error\";\n\t\t\t\t\tgs.addErrorMessage(gs.getMessage('Mauvais numéro automate'));\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\t\t\t\tinc_desc += 'Entité = ' + gr_customerAccount.name;\n\t\t\t}\n\n\t\t\tinc_desc = inc_desc + '\\nNuméro Automate = ' + input.automate_num;\n\t\t\tinc_desc = inc_desc + '\\nNom interlocuteur = ' + input.name_society_tech + \" / \" + input.mail;\n\t\t\tinc_desc = inc_desc + '\\nTéléphone = ' + input.phone;\n\t\t\tinc_desc = inc_desc + '\\nObjet de la demande = AppelTech - ' + input.panne_description;\n\n\t\t\tgr.setValue('description', inc_desc);\n\t\t\tgr.setValue('u_date_de_d_tection_de_l_incident', new GlideDateTime());\n\t\t\tgr.caller_id = \"appeltech@caps.com\";\n\n\t\t\tvar sys_id = gr.insert();\n\t\t\tif (!gs.nil(sys_id)) {\n\t\t\t\tdata.sys_id = sys_id;\n\t\t\t\tdata.inc_number = gr.number.toString();\n\t\t\t\tdata.status = \"success\";\n\t\t\t\tdata.message = gs.getMessage(\"Your request has been submitted and is pending review. You will receive an email when your request is processed.\");\n\n\t\t\t\tvar json = {\n\t\t\t\t\t\"ref\": gr.number.toString(),\n\t\t\t\t\t\"description\": input.panne_description,\n\t\t\t\t\t\"automate_number\": input.automate_num,\n\t\t\t\t\t\"phone\": input.phone,\n\t\t\t\t\t\"name_society_tech\": input.name_society_tech\n\t\t\t\t};\n\t\t\t\tvar jsonString = JSON.stringify(json);\n\t\t\t\tgs.eventQueue(\"appeltech.sendnotif\", current, input.mail, jsonString);\n\t\t\t} else {\n\t\t\t\tdata.status = \"error\";\n\t\t\t\tgs.addErrorMessage(gs.getMessage('Erreur lors de l\\'insert'));\n\t\t\t}\n\t\t\treturn data;\n\t\t} else {\n\t\t\tgs.addErrorMessage(gs.getMessage('Robot détecté'));\n\t\t\tdata.status = \"error\";\n\t\t\treturn data;\n\t\t}\n\t}\n\n\n\tfunction checkEmail(email) {\n\t\tconst isvalidEmail = email && /\\S+@\\S+\\.\\S+/.test(email);\n\t\treturn true;\n\t\t//return isvalidEmail;\n\t}\n\n\tfunction checkPhone(phone) {\n\t\tconst isvalidPhone = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\\s\\./0-9]*$/.test(phone);\n\t\treturn isvalidPhone;\n\t}\n\n\tfunction responseTokenRecaptcha(token) {\n\t\tconst data = {}\n        try {\n            var RESTCAPTCHA = new sn_ws.RESTMessageV2();\n            RESTCAPTCHA.setHttpMethod('post');\n            RESTCAPTCHA.setEndpoint('https://www.google.com/recaptcha/api/siteverify');\n            RESTCAPTCHA.setQueryParameter('secret', captchaSiteKeySecret); //gs.getProperty('recaptcha.secret-key')\n            RESTCAPTCHA.setQueryParameter('response', token);\n            var captchaResponse = RESTCAPTCHA.execute();\n            if (captchaResponse.haveError()) {\n                gs.addErrorMessage('Error in validating captcha response: ' + captchaResponse.getErrorMessage() + '. Status code: ' + captchaResponse.getStatusCode(), 'CaptchaAjax script include');\n                data.captchaResponse = {\n\t\t\t\t\tstatus: \"error\",\n\t\t\t\t};\n            }\n            var successResponse = captchaResponse.getBody(); //Relies on ES5 syntax. For ES3, use new JSON().decode(json_string);\n            data.captchaResponse = JSON.parse(successResponse);\n        } catch (ex) {\n            gs.addErrorMessage('Error in processing response from reCAPTCHA: ' + ex.message, 'CaptchaAjax script include');\n            data.captchaResponse = {\n\t\t\t\tstatus: \"error\",\n\t\t\t};\n        }\n\t\treturn data.captchaResponse;\n\t}\n\t//Desactivation du formulaire le samedi/dimanche\n\tvar date = new Date().getDay();\n\tif(date==6 || date==0){ //6==samedi 0==dimanche\n\t\tdata.display = true;\n\t}else{\n\t\tdata.display =false;\n\t}\n\t\n\t\n\t\n\n\n\n})($sp, input, data, options);",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function ($sp, input, data, options) {\n\t// data.captch_url = 'https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit&hl=' + gs.getSession().getLanguage();\n\tdata.enableCaptcha = gs.getProperty('sn_customerservice.captchaEnabled');\n\tdata.captchaSiteKey = gs.getProperty('caps.recaptcha.site-key');\n\tvar captchaSiteKeySecret = gs.getProperty('caps.recaptcha.site-key.secret');\n\n\tif(input && input.action == 'register') {\n\t\tdata.captchaResponse = responseTokenRecaptcha(input.captchaToken);\n\t}\n\n\tif (input && input.action == 'register' && input.name_society_tech && input.automate_num && +input.automate_num && checkEmail(input.mail) && input.panne_description && input.phone && checkPhone(input.phone)) {\n\t\tif (data.captchaResponse.success == true && data.captchaResponse.score > 0.5) {\n\t\t\tgr = new GlideRecord('incident');\n\t\t\tgr.initialize();\n\t\t\tgr.applyTemplate('PRODUCTION PFA SUPPORT ALBI - PORTAIL');//MODELES INCIDENT AUTOMATE UNITAIRE\n\n\t\t\tvar inc_desc = '';\n\t\t\tvar lastNumber = input.automate_num.substr(input.automate_num.length - 5);\n\t\t\tvar gr_customerAccount;\n\n\t\t\tvar entities = [['HSBC', 'LCL', 'Chabières', 'Chalus'], ['30056', '30002', '41539', \"10188\"]];\n\n\t\t\tif (entities[1].indexOf(lastNumber) != -1) {\n\t\t\t\tinc_desc += 'Entité = ' + entities[0][entities[1].indexOf(lastNumber)];\n\t\t\t} else {\n\t\t\t\tgr_customerAccount = new GlideRecord('customer_account');\n\t\t\t\tgr_customerAccount.addQuery('parent', \"6cd347521b18849063b9dc29cd4bcb4a\");\n\t\t\t\tgr_customerAccount.addEncodedQuery('nameLIKE' + lastNumber);\n\t\t\t\tgr_customerAccount.query();\n\t\t\t\tgr_customerAccount.next();\n\t\t\t\tif (gr_customerAccount.name == '') {\n\t\t\t\t\tdata.status = \"error\";\n\t\t\t\t\tgs.addErrorMessage(gs.getMessage('Mauvais numéro automate'));\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\t\t\t\tinc_desc += 'Entité = ' + gr_customerAccount.name;\n\t\t\t}\n\n\t\t\tinc_desc = inc_desc + '\\nNuméro Automate = ' + input.automate_num;\n\t\t\tinc_desc = inc_desc + '\\nNom interlocuteur = ' + input.name_society_tech + \" / \" + input.mail;\n\t\t\tinc_desc = inc_desc + '\\nTéléphone = ' + input.phone;\n\t\t\tinc_desc = inc_desc + '\\nObjet de la demande = AppelTech - ' + input.panne_description;\n\n\t\t\tgr.setValue('description', inc_desc);\n\t\t\tgr.setValue('u_date_de_d_tection_de_l_incident', new GlideDateTime());\n\t\t\tgr.caller_id = \"appeltech@caps.com\";\n\n\t\t\tvar sys_id = gr.insert();\n\t\t\tif (!gs.nil(sys_id)) {\n\t\t\t\tdata.sys_id = sys_id;\n\t\t\t\tdata.inc_number = gr.number.toString();\n\t\t\t\tdata.status = \"success\";\n\t\t\t\tdata.message = gs.getMessage(\"Your request has been submitted and is pending review. You will receive an email when your request is processed.\");\n\n\t\t\t\tvar json = {\n\t\t\t\t\t\"ref\": gr.number.toString(),\n\t\t\t\t\t\"description\": input.panne_description,\n\t\t\t\t\t\"automate_number\": input.automate_num,\n\t\t\t\t\t\"phone\": input.phone,\n\t\t\t\t\t\"name_society_tech\": input.name_society_tech\n\t\t\t\t};\n\t\t\t\tvar jsonString = JSON.stringify(json);\n\t\t\t\tgs.eventQueue(\"appeltech.sendnotif\", current, input.mail, jsonString);\n\t\t\t} else {\n\t\t\t\tdata.status = \"error\";\n\t\t\t\tgs.addErrorMessage(gs.getMessage('Erreur lors de l\\'insert'));\n\t\t\t}\n\t\t\treturn data;\n\t\t} else {\n\t\t\tgs.addErrorMessage(gs.getMessage('Robot détecté'));\n\t\t\tdata.status = \"error\";\n\t\t\treturn data;\n\t\t}\n\t}\n\n\n\tfunction checkEmail(email) {\n\t\tconst isvalidEmail = email && /\\S+@\\S+\\.\\S+/.test(email);\n\t\treturn true;\n\t\t//return isvalidEmail;\n\t}\n\n\tfunction checkPhone(phone) {\n\t\tconst isvalidPhone = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\\s\\./0-9]*$/.test(phone);\n\t\treturn isvalidPhone;\n\t}\n\n\tfunction responseTokenRecaptcha(token) {\n\t\tconst data = {}\n        try {\n            var RESTCAPTCHA = new sn_ws.RESTMessageV2();\n            RESTCAPTCHA.setHttpMethod('post');\n            RESTCAPTCHA.setEndpoint('https://www.google.com/recaptcha/api/siteverify');\n            RESTCAPTCHA.setQueryParameter('secret', captchaSiteKeySecret); //gs.getProperty('recaptcha.secret-key')\n            RESTCAPTCHA.setQueryParameter('response', token);\n            var captchaResponse = RESTCAPTCHA.execute();\n            if (captchaResponse.haveError()) {\n                gs.addErrorMessage('Error in validating captcha response: ' + captchaResponse.getErrorMessage() + '. Status code: ' + captchaResponse.getStatusCode(), 'CaptchaAjax script include');\n                data.captchaResponse = {\n\t\t\t\t\tstatus: \"error\",\n\t\t\t\t};\n            }\n            var successResponse = captchaResponse.getBody(); //Relies on ES5 syntax. For ES3, use new JSON().decode(json_string);\n            data.captchaResponse = JSON.parse(successResponse);\n        } catch (ex) {\n            gs.addErrorMessage('Error in processing response from reCAPTCHA: ' + ex.message, 'CaptchaAjax script include');\n            data.captchaResponse = {\n\t\t\t\tstatus: \"error\",\n\t\t\t};\n        }\n\t\treturn data.captchaResponse;\n\t}\n\t//Desactivation du formulaire le samedi/dimanche\n\tvar date = new Date().getDay();\n\tif(date==6 || date==0){ //6==samedi 0==dimanche\n\t\tdata.display = true;\n\t}else{\n\t\tdata.display =false;\n\t}\n\t\n\t\n\t\n\n\n\n})($sp, input, data, options);",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function ($scope, $rootScope, $timeout, spUtil, $location) {\n\tvar c = this;\n\n\tif (c.data.is_logged_in) {\n\t\t$location.url($scope.portal.url_suffix);\n\t}\n\n\tc.policy = false;\n\n\n\tc.name_society_tech = '';\n\tc.phone = '';\n\tc.automate_num = '';\n\tc.concerned_entity = '';\n\tc.panne_description = '';\n\tc.mail = '';\n\n\n\t// CustomEvent.observe('sn_csm_captcha_verified', function (obj) {\n\t// \tc.captchaVerified = obj.captchaVerified;\n\t// \tc.grc = obj.grc;\n\t// \tscope.$apply();\n\t// });\n\n\tc.showSubmit = function () {\n\n\t\tif (c.data.enableCaptcha == 'false')\n\t\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.automate_num && c.automate_num.toString().length == 13 && +c.automate_num && c.checkEmail() && c.checkPhoneNumber());\n\t\telse\n\t\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.panne_description.length > 1 && c.automate_num && c.automate_num.toString().length == 13 && + c.automate_num && c.checkEmail() && c.checkPhoneNumber());\n\t};\n\n\tc.enableCaptcha = function () {\n\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.automate_num && c.automate_num.toString().length == 13 && +c.automate_num && c.checkPhoneNumber());\n\t};\n\n\tc.checkPhoneNumber = function () {\n\t\tconst isPhoneNumber = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\\s\\./0-9]*$/.test(c.phone);\n\t\treturn isPhoneNumber;\n\t}\n\n\tc.checkEmail = function () {\n\t\tconst isvalidEmail = /\\S+@\\S+\\.\\S+/.test(c.mail);\n\t\treturn true;\n\t\t//return isvalidEmail;\n\t}\n\n\tc.action = function () {\n\t\tgrecaptcha.enterprise.ready(function () {\n\t\t\tgrecaptcha.enterprise.execute(c.data.captchaSiteKey, { action: 'appeltech' }).then(function (token) {\n\t\t\t\tc.data.action = 'register';\n\t\t\t\tc.data.name_society_tech = c.name_society_tech;\n\t\t\t\tc.data.phone = c.phone;\n\t\t\t\tc.data.automate_num = c.automate_num.toString();\n\t\t\t\tc.data.panne_description = c.panne_description;\n\t\t\t\tc.data.mail = c.mail;\n\n\t\t\t\tc.data.captchaToken = token;\n\n\t\t\t\tc.data.grc = c.grc;\n\t\t\t\tc.server.update().then(function (response) {\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t\tif (response.status == 'success' && response.captchaResponse.success == true && response.captchaResponse.score > 0.5) {\n\t\t\t\t\t\tc.success = response[\"message\"];\n\t\t\t\t\t\t$location.url('/interv_automate?id=atcp_congrats&inc_id=' + c.data.inc_number + \"&mail=\" + c.data.mail);\n\t\t\t\t\t} else if (response.status == 'error') {\n\t\t\t\t\t\tc.success = 'There was an error processing your request';\n\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t// $window.location += \"\";\n\t\t\t\t\t\t// c.captchaVerified = false;\n\t\t\t\t\t\t// c.captchaExpired();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\t\n}",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function ($scope, $rootScope, $timeout, spUtil, $location) {\n\tvar c = this;\n\n\tif (c.data.is_logged_in) {\n\t\t$location.url($scope.portal.url_suffix);\n\t}\n\n\tc.policy = false;\n\n\n\tc.name_society_tech = '';\n\tc.phone = '';\n\tc.automate_num = '';\n\tc.concerned_entity = '';\n\tc.panne_description = '';\n\tc.mail = '';\n\n\n\t// CustomEvent.observe('sn_csm_captcha_verified', function (obj) {\n\t// \tc.captchaVerified = obj.captchaVerified;\n\t// \tc.grc = obj.grc;\n\t// \tscope.$apply();\n\t// });\n\n\tc.showSubmit = function () {\n\n\t\tif (c.data.enableCaptcha == 'false')\n\t\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.automate_num && c.automate_num.toString().length == 13 && +c.automate_num && c.checkEmail() && c.checkPhoneNumber());\n\t\telse\n\t\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.panne_description.length > 1 && c.automate_num && c.automate_num.toString().length == 13 && + c.automate_num && c.checkEmail() && c.checkPhoneNumber());\n\t};\n\n\tc.enableCaptcha = function () {\n\t\treturn !(c.name_society_tech.split(' ').length > 1 && c.policy == true && c.automate_num && c.automate_num.toString().length == 13 && +c.automate_num && c.checkPhoneNumber());\n\t};\n\n\tc.checkPhoneNumber = function () {\n\t\tconst isPhoneNumber = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\\s\\./0-9]*$/.test(c.phone);\n\t\treturn isPhoneNumber;\n\t}\n\n\tc.checkEmail = function () {\n\t\tconst isvalidEmail = /\\S+@\\S+\\.\\S+/.test(c.mail);\n\t\treturn true;\n\t\t//return isvalidEmail;\n\t}\n\n\tc.action = function () {\n\t\tgrecaptcha.enterprise.ready(function () {\n\t\t\tgrecaptcha.enterprise.execute(c.data.captchaSiteKey, { action: 'appeltech' }).then(function (token) {\n\t\t\t\tc.data.action = 'register';\n\t\t\t\tc.data.name_society_tech = c.name_society_tech;\n\t\t\t\tc.data.phone = c.phone;\n\t\t\t\tc.data.automate_num = c.automate_num.toString();\n\t\t\t\tc.data.panne_description = c.panne_description;\n\t\t\t\tc.data.mail = c.mail;\n\n\t\t\t\tc.data.captchaToken = token;\n\n\t\t\t\tc.data.grc = c.grc;\n\t\t\t\tc.server.update().then(function (response) {\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t\tif (response.status == 'success' && response.captchaResponse.success == true && response.captchaResponse.score > 0.5) {\n\t\t\t\t\t\tc.success = response[\"message\"];\n\t\t\t\t\t\t$location.url('/interv_automate?id=atcp_congrats&inc_id=' + c.data.inc_number + \"&mail=\" + c.data.mail);\n\t\t\t\t\t} else if (response.status == 'error') {\n\t\t\t\t\t\tc.success = 'There was an error processing your request';\n\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t// $window.location += \"\";\n\t\t\t\t\t\t// c.captchaVerified = false;\n\t\t\t\t\t\t// c.captchaExpired();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\t\n}",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "atcp_offer",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "atcp_offer",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "encode_utf8": "false",
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true",
                "edge_encryption_enabled": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "atcp_offer",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "atcp_offer",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}